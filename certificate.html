<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Certificate Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f4f4f4;
      padding: 20px;
    }
    #certificateCanvas {
      border: 1px solid #ccc;
      margin-top: 20px;
      max-width: 100%;
    }
    button {
      margin: 20px;
      padding: 12px 25px;
      cursor: pointer;
      border: none;
      background: #007bff;
      color: white;
      font-size: 16px;
      border-radius: 6px;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h2>Certificate Preview</h2>

  <canvas id="certificateCanvas"></canvas>
  <br>
  <button onclick="downloadPDF()">Download PDF</button>
  <button onclick="window.location.href='index.html'">Back</button>

  <script>
    const { jsPDF } = window.jspdf;
    const canvas = document.getElementById("certificateCanvas");
    const ctx = canvas.getContext("2d");

    const template = new Image();
    template.src = "certificate.jpg"; // background image

    // Read name & club from URL
    const urlParams = new URLSearchParams(window.location.search);
    const name = urlParams.get("name");
    const club = urlParams.get("club");

    template.onload = function () {
      canvas.width = template.width;
      canvas.height = template.height;
      drawCertificate(name, club);
    };

    function drawCertificate(name, club) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(template, 0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "#000";
      ctx.textAlign = "center";

      let text = name + " ( " + club + " )";

      // Adjust font size based on character length
      let fontSize = 48;
      let leftMargin = 105;
      const length = text.length -5;

      if (length >= 55) {fontSize = 24;  leftMargin=119}
      else if (length > 40) {fontSize = 28;leftMargin=115;}
      else if (length > 32) {fontSize = 36; leftMargin=120;}
      else if (length >= 25 && length <=32) {fontSize = 40; leftMargin = 120;}

      ctx.font = `bold ${fontSize}px "Fira Sans", sans-serif`;

      // Draw text centered
      ctx.fillText(text, canvas.width / 2 + leftMargin, canvas.height / 2);

    }

    function downloadPDF() {
      const pdf = new jsPDF({
        orientation: "landscape",
        unit: "px",
        format: [canvas.width, canvas.height],
      });

      pdf.addImage(canvas.toDataURL("image/png"), "PNG", 0, 0, canvas.width, canvas.height);
      pdf.save("certificate.pdf");
    }
  </script>
</body>
</html>
